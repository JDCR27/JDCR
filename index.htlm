<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cartas ‚Äî Colecci√≥n</title>
  <meta name="description" content="Sitio simple para subir/publicar cartas: b√∫squeda, filtros, lectura y descarga." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0f14;       /* fondo oscuro elegante */
      --card: #121821;     /* tarjetas */
      --text: #e8eef7;     /* texto principal */
      --muted: #9db0c9;    /* texto secundario */
      --accent: #6aa2ff;   /* acento */
      --accent-2: #8ef;    /* acento claro */
      --border: #223044;   /* bordes */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: linear-gradient(120deg, #0a0e13 0%, #0d1520 50%, #0b0f14 100%);
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom: 20px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:40px; height:40px; border-radius:12px; background: radial-gradient(circle at 30% 30%, var(--accent), #214); box-shadow: var(--shadow); }
    h1 { font-size: clamp(22px, 3vw, 30px); margin: 0; letter-spacing:.3px; }
    .muted { color: var(--muted); }

    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .input, .select {
      background: #0e1520; border: 1px solid var(--border); color: var(--text);
      padding: 10px 12px; border-radius: 12px; outline:none;
      box-shadow: inset 0 0 0 9999px rgba(255,255,255,0);
      transition: border .2s, box-shadow .2s, transform .08s ease;
    }
    .input:focus, .select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,162,255,.18); }
    .btn {
      background: linear-gradient(180deg, #1b2a44, #142033);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600;
      transition: transform .08s ease, filter .2s, border .2s;
    }
    .btn:hover { filter: brightness(1.08); }
    .btn:active { transform: translateY(1px) scale(0.99); }
    .btn-ghost { background: transparent; border: 1px dashed var(--border); }

    .grid { display:grid; grid-template-columns: repeat( auto-fit, minmax(260px, 1fr) ); gap:16px; }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 18px; padding: 16px; box-shadow: var(--shadow); position: relative; overflow: hidden; }
    .card h3 { margin: 0 0 8px; font-size: 18px; }
    .tags { display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px; }
    .tag { font-size:12px; padding:6px 10px; border-radius:99px; border:1px solid var(--border); color: var(--muted); background:#0d1420; }
    .card .meta { font-size: 12px; color: var(--muted); display:flex; align-items:center; gap:8px; }
    .card .actions { display:flex; gap:8px; margin-top: 12px; }

    .pill { font-size:11px; padding:6px 10px; border-radius:99px; background:#0e1622; border:1px solid var(--border); color: var(--muted); }

    .empty { text-align:center; padding: 40px 10px; border:1px dashed var(--border); border-radius: 16px; color: var(--muted); }

    /* Modal */
    dialog { width: min(920px, 96vw); max-height: 90vh; border:1px solid var(--border); border-radius: 16px; background: #0e1520; color: var(--text); box-shadow: var(--shadow); }
    dialog::backdrop { backdrop-filter: blur(6px); background: rgba(8,12,18,.6); }
    .modal-head { display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 14px 16px; border-bottom: 1px solid var(--border); position: sticky; top:0; background: #0e1520; }
    .modal-title { font-size: 18px; font-weight: 700; margin:0; }
    .modal-body { padding: 16px; overflow:auto; max-height: calc(90vh - 120px); }
    .modal-actions { display:flex; gap:8px; }

    .prose { line-height: 1.7; font-size: 16px; white-space: pre-wrap; }

    footer { margin: 28px 0 10px; text-align:center; color: var(--muted); font-size: 12px; }
    .link { color: var(--accent-2); text-decoration: none; border-bottom: 1px dashed rgba(142,238,255,.3); }

    /* Small helper */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Cartas ‚Ä¢ Colecci√≥n</h1>
          <div class="muted" style="font-size:14px">Sube/publica tus cartas y comp√°rtelas f√°cilmente.</div>
        </div>
      </div>
      <div class="toolbar">
        <label class="sr-only" for="q">Buscar</label>
        <input class="input" id="q" type="search" placeholder="Buscar por t√≠tulo, etiqueta o texto‚Ä¶" />
        <select class="select" id="filterTag">
          <option value="">Todas las etiquetas</option>
        </select>
        <button class="btn" id="btnAdd">A√±adir carta</button>
        <button class="btn btn-ghost" id="btnExport" title="Exportar JSON">Exportar</button>
      </div>
    </header>

    <section id="stats" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px">
      <span class="pill" id="countPill">0 cartas</span>
      <span class="pill" id="filterPill" style="display:none"></span>
    </section>

    <section id="list" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" style="display:none">No hay resultados.
      <div style="margin-top:8px"><button class="btn btn-ghost" id="clearFilters">Quitar filtros</button></div>
    </div>

    <footer>
      Hecho con ‚ù§Ô∏è ‚Ä¢ Sube este <span>index.html</span> a GitHub Pages y listo. ‚Äî 
      <a class="link" href="#" id="howTo">¬øC√≥mo edito/a√±ado cartas?</a>
    </footer>
  </div>

  <!-- Modal lectura -->
  <dialog id="reader">
    <div class="modal-head">
      <h2 class="modal-title" id="readerTitle">T√≠tulo</h2>
      <div class="modal-actions">
        <button class="btn" id="copyBtn">Copiar</button>
        <button class="btn" id="printBtn">Imprimir</button>
        <button class="btn" id="downloadBtn">Descargar</button>
        <button class="btn btn-ghost" id="closeReader">Cerrar</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="muted" id="readerMeta" style="margin-bottom:8px"></div>
      <article class="prose" id="readerContent"></article>
    </div>
  </dialog>

  <!-- Modal a√±adir/editar -->
  <dialog id="editor">
    <div class="modal-head">
      <h2 class="modal-title" id="editorTitle">Nueva carta</h2>
      <div class="modal-actions">
        <button class="btn" id="saveCard">Guardar</button>
        <button class="btn btn-ghost" id="cancelEdit">Cancelar</button>
      </div>
    </div>
    <div class="modal-body">
      <form id="form" onsubmit="return false;" style="display:grid; gap:10px">
        <div>
          <label for="title">T√≠tulo</label>
          <input id="title" class="input" placeholder="Ej. Carta a‚Ä¶" required />
        </div>
        <div>
          <label for="tags">Etiquetas (separadas por coma)</label>
          <input id="tags" class="input" placeholder="amor, amistad, despedida" />
        </div>
        <div>
          <label for="content">Contenido</label>
          <textarea id="content" class="input" style="min-height: 200px; width:100%" placeholder="Escribe o pega tu carta aqu√≠‚Ä¶" required></textarea>
        </div>
      </form>
    </div>
  </dialog>

  <script>
    /* =================== DATOS (edita aqu√≠) ===================
       üëâ Reemplaza/a√±ade tus cartas dentro del array LETTERS.
       Cada carta tiene: id, title, tags[], date (YYYY-MM-DD), content.
       Puedes usar saltos de l√≠nea en content y emojis. */
    const LETTERS = [
      {
        id: crypto.randomUUID(),
        title: "Carta 1 ‚Äî Ejemplo",
        tags: ["amistad", "agradecimiento"],
        date: "2025-08-10",
        content: `Querida A: \n\nGracias por estar. Esta es una carta de ejemplo.\n\nCon cari√±o,\nYo`
      },
      {
        id: crypto.randomUUID(),
        title: "Carta 2 ‚Äî Ejemplo",
        tags: ["amor", "despedida"],
        date: "2025-08-15",
        content: `Hoy cierro un cap√≠tulo. Gracias por todo lo vivido.\n\nSiempre,\nYo`
      }
    ];

    // Estado
    let state = {
      q: new URLSearchParams(location.search).get('q') || '',
      tag: new URLSearchParams(location.search).get('tag') || '',
      letters: [...LETTERS],
      editingId: null,
      readingId: null,
    };

    // UI refs
    const list = document.getElementById('list');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');
    const filterTag = document.getElementById('filterTag');
    const countPill = document.getElementById('countPill');
    const filterPill = document.getElementById('filterPill');

    const reader = document.getElementById('reader');
    const readerTitle = document.getElementById('readerTitle');
    const readerContent = document.getElementById('readerContent');
    const readerMeta = document.getElementById('readerMeta');
    const closeReader = document.getElementById('closeReader');
    const copyBtn = document.getElementById('copyBtn');
    const printBtn = document.getElementById('printBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    const editor = document.getElementById('editor');
    const editorTitle = document.getElementById('editorTitle');
    const saveCard = document.getElementById('saveCard');
    const cancelEdit = document.getEle
