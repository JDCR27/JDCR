<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cartas — Colección</title>
  <meta name="description" content="Sitio simple para subir/publicar cartas: búsqueda, filtros, lectura y descarga." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0f14;       /* fondo oscuro elegante */
      --card: #121821;     /* tarjetas */
      --text: #e8eef7;     /* texto principal */
      --muted: #9db0c9;    /* texto secundario */
      --accent: #6aa2ff;   /* acento */
      --accent-2: #8ef;    /* acento claro */
      --border: #223044;   /* bordes */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: linear-gradient(120deg, #0a0e13 0%, #0d1520 50%, #0b0f14 100%);
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom: 20px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:40px; height:40px; border-radius:12px; background: radial-gradient(circle at 30% 30%, var(--accent), #214); box-shadow: var(--shadow); }
    h1 { font-size: clamp(22px, 3vw, 30px); margin: 0; letter-spacing:.3px; }
    .muted { color: var(--muted); }

    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .input, .select {
      background: #0e1520; border: 1px solid var(--border); color: var(--text);
      padding: 10px 12px; border-radius: 12px; outline:none;
      box-shadow: inset 0 0 0 9999px rgba(255,255,255,0);
      transition: border .2s, box-shadow .2s, transform .08s ease;
    }
    .input:focus, .select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,162,255,.18); }
    .btn {
      background: linear-gradient(180deg, #1b2a44, #142033);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600;
      transition: transform .08s ease, filter .2s, border .2s;
    }
    .btn:hover { filter: brightness(1.08); }
    .btn:active { transform: translateY(1px) scale(0.99); }
    .btn-ghost { background: transparent; border: 1px dashed var(--border); }

    .grid { display:grid; grid-template-columns: repeat( auto-fit, minmax(260px, 1fr) ); gap:16px; }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 18px; padding: 16px; box-shadow: var(--shadow); position: relative; overflow: hidden; }
    .card h3 { margin: 0 0 8px; font-size: 18px; }
    .tags { display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px; }
    .tag { font-size:12px; padding:6px 10px; border-radius:99px; border:1px solid var(--border); color: var(--muted); background:#0d1420; }
    .card .meta { font-size: 12px; color: var(--muted); display:flex; align-items:center; gap:8px; }
    .card .actions { display:flex; gap:8px; margin-top: 12px; }

    .pill { font-size:11px; padding:6px 10px; border-radius:99px; background:#0e1622; border:1px solid var(--border); color: var(--muted); }

    .empty { text-align:center; padding: 40px 10px; border:1px dashed var(--border); border-radius: 16px; color: var(--muted); }

    /* Modal */
    dialog { width: min(920px, 96vw); max-height: 90vh; border:1px solid var(--border); border-radius: 16px; background: #0e1520; color: var(--text); box-shadow: var(--shadow); }
    dialog::backdrop { backdrop-filter: blur(6px); background: rgba(8,12,18,.6); }
    .modal-head { display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 14px 16px; border-bottom: 1px solid var(--border); position: sticky; top:0; background: #0e1520; }
    .modal-title { font-size: 18px; font-weight: 700; margin:0; }
    .modal-body { padding: 16px; overflow:auto; max-height: calc(90vh - 120px); }
    .modal-actions { display:flex; gap:8px; }

    .prose { line-height: 1.7; font-size: 16px; white-space: pre-wrap; }

    footer { margin: 28px 0 10px; text-align:center; color: var(--muted); font-size: 12px; }
    .link { color: var(--accent-2); text-decoration: none; border-bottom: 1px dashed rgba(142,238,255,.3); }

    /* Small helper */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Cartas • Colección</h1>
          <div class="muted" style="font-size:14px">Sube/publica tus cartas y compártelas fácilmente.</div>
        </div>
      </div>
      <div class="toolbar">
        <label class="sr-only" for="q">Buscar</label>
        <input class="input" id="q" type="search" placeholder="Buscar por título, etiqueta o texto…" />
        <select class="select" id="filterTag">
          <option value="">Todas las etiquetas</option>
        </select>
        <button class="btn" id="btnAdd">Añadir carta</button>
        <button class="btn btn-ghost" id="btnExport" title="Exportar JSON">Exportar</button>
      </div>
    </header>

    <section id="stats" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px">
      <span class="pill" id="countPill">0 cartas</span>
      <span class="pill" id="filterPill" style="display:none"></span>
    </section>

    <section id="list" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" style="display:none">No hay resultados.
      <div style="margin-top:8px"><button class="btn btn-ghost" id="clearFilters">Quitar filtros</button></div>
    </div>

    <footer>
      Hecho con ❤️ • Sube este <span>index.html</span> a GitHub Pages y listo. — 
      <a class="link" href="#" id="howTo">¿Cómo edito/añado cartas?</a>
    </footer>
  </div>

  <!-- Modal lectura -->
  <dialog id="reader">
    <div class="modal-head">
      <h2 class="modal-title" id="readerTitle">Título</h2>
      <div class="modal-actions">
        <button class="btn" id="copyBtn">Copiar</button>
        <button class="btn" id="printBtn">Imprimir</button>
        <button class="btn" id="downloadBtn">Descargar</button>
        <button class="btn btn-ghost" id="closeReader">Cerrar</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="muted" id="readerMeta" style="margin-bottom:8px"></div>
      <article class="prose" id="readerContent"></article>
    </div>
  </dialog>

  <!-- Modal añadir/editar -->
  <dialog id="editor">
    <div class="modal-head">
      <h2 class="modal-title" id="editorTitle">Nueva carta</h2>
      <div class="modal-actions">
        <button class="btn" id="saveCard">Guardar</button>
        <button class="btn btn-ghost" id="cancelEdit">Cancelar</button>
      </div>
    </div>
    <div class="modal-body">
      <form id="form" onsubmit="return false;" style="display:grid; gap:10px">
        <div>
          <label for="title">Título</label>
          <input id="title" class="input" placeholder="Ej. Carta a…" required />
        </div>
        <div>
          <label for="tags">Etiquetas (separadas por coma)</label>
          <input id="tags" class="input" placeholder="amor, amistad, despedida" />
        </div>
        <div>
          <label for="content">Contenido</label>
          <textarea id="content" class="input" style="min-height: 200px; width:100%" placeholder="Escribe o pega tu carta aquí…" required></textarea>
        </div>
      </form>
    </div>
  </dialog>

  <script>
      const LETTERS = [
      {
        id: crypto.randomUUID(),
        title: "Carta 1 — RECUERDOS",
        tags: ["amistad", "agradecimiento"],
        date: "2025-08-10",
        content: `Hola, Gasparina. Bueno… quería escribirte unas cuantas cartas en las que, creo yo, pueda plasmar un poco de las cosas que siempre deseé decirte o, al menos, algunas cuestiones que quedaron en duda para mí.
Cuando te vi por primera vez, te digo sin exagerar que sentí una sensación de curiosidad, que más adelante terminó convirtiéndose en sentimientos muy intensos hacia ti. Yo traté de ignorarlo, pero no pude; consiguientemente, intenté acercarme de una forma invasiva y quise forzar que surgiera algún tipo de lazo social entre tú y yo. Se supone que esas cosas surgen siempre de manera natural. Quiero disculparme por este medio, porque en persona no sabría elegir bien las palabras. Te pido perdón por las diversas situaciones en las que te viste involucrada por mi culpa, e incluso quiero decirte que aún no olvido esa vez en la que, por la intensidad de todo, terminaste quebrándote en clase. Aunque sea demasiado tarde, quiero decirte que estoy profundamente arrepentido de eso y de otras cosas que pudieron haberte hecho daño, solo por el hecho de que tú me gustaras.
Yo… sé que nunca llegué a entenderte, y, sin embargo, siempre disfrutaba de tu presencia. Sí, algo tan trivial como el simple hecho de estar cerca de ti era suficiente para ponerme muy feliz y de buen humor. Te mentiría si dijera que hoy en día no disfruto de tenerte cerca, aunque no hablemos mucho. Solo sé que eso me transmite una sensación de calidez que hasta el día de hoy no he podido sentir con nadie más. También quiero expresarte que, con lo poco que llegué a compartir contigo, comprendí un poco de tu personalidad, y me atrevo a decir que realmente eres y serás alguien a quien considero que vale la pena conocer. Por eso mismo, a veces me arrepiento de no haber sabido aprovechar más el tiempo contigo y de haber esperado hasta que nuestro último año en secundaria estuviera por acabar para recién intentar acercarme a ti.
Quiero agradecerte por haberme tenido paciencia, incluso después de los malos ratos que te hice pasar.`
      },
      {
        id: crypto.randomUUID(),
        title: "Carta 2 — ENTRE RISAS Y MOMENTOS",
        tags: ["amor", "despedida"],
        date: "2025-08-15",
        content: `Cuando me pongo a recordar y pensar detalladamente en estos dos años, siempre llego a la misma conclusión: “Pudiste haber aprovechado mejor el tiempo en conocerla y, por lo menos, haber forjado una pequeña amistad”. Y bueno, la única solución que he llegado a contemplar en estos momentos fue aprovechar todo el tiempo posible en estos dos últimos meses del año para acercarme un poco a ti y compartir momentos, sean buenos o malos. Aunque, por ahora, creo que serán recuerdos buenos. Te digo que me agrada mucho cuando me cuentas tus vivencias o cuando intentas bromear conmigo (aunque no lo parezca). Además, creo que estamos a mano, puesto que yo también te molesto; aunque no se me dé bien ser bromista, me da risa cuando te enojas y pones esa cara parecida al sticker del oso que tienes en WhatsApp.
Otra cosa que recuerdo es cuando te agarro los cachetes. En parte lo hago porque son bien suavecitos y calentitos, agradables al tacto. También recordaré siempre cómo escondes tu cara para que no lo haga; sabes, eso se me hace un poco tierno y gracioso cuando lo haces.
Y tampoco olvidaré los trabajos grupales, cuando nos dices manganzones, o cuando en el aula, por la emoción —imagino yo—, se te escapaban ciertas palabras como: colorcita, cuando hay hay, y cuando no hay no hay pues, lambido, entre otras cosas que ya no recuerdo bien. Todo eso, te juro, me da mucha risa cuando lo dices. Y bueno, decirte que, si alguien llega a mencionar esas palabras o similares, tengo por seguro que me acordaré de Marimar jajaja.
Por cierto, no sé si será algún perfume o algo que usas, pero te juro que esa fragancia me llegó a encantar demasiado. Tanto me acostumbré a olerla solo en ti, que, si llego a percibir ese aroma en la calle, me confundo y volteo a mirar, por si acaso estás cerca.
Y bueno, esto último no quiero olvidarlo: fue en tu cabello donde aprendí a hacer trenzas y donde usé mi anillo como carmín jajaja. Gracias por dejarme aprender con tu cabello, Marimar.`
      },
      {
        id: crypto.randomUUID(),
        title: "Carta 3 — SAKURA",
        tags: ["amor"],
        date: "2025-08-15",
        content: `Fiorela, quiero decirte que sinceramente aún te sigo amando o, al menos, queriendo. El escribirte esto me hace recordar aquella vez en Huanchaco en la que intenté confesarte mis sentimientos, pero bueno… me imagino que te diste cuenta de que los nervios me ganaron. Sinceramente, ya tenía previsto aquel rechazo; sin embargo, hubiera preferido un poco más de sinceridad, o incluso un simple “no” por respuesta. Con respecto a mis sentimientos actuales, aunque todavía se desbordan por ti, hace tiempo desistí de querer algo contigo. Y bueno, más que todo porque considero que ya es algo a lo que debía ponerle un alto. También porque quizá tú ya tengas alguna relación con alguien, y pues, no deseo volver a ser un fastidio para ti.
Otra cosa que nunca te dije, como ya vengo mencionando en las cartas anteriores, es que tal vez hubiera sido bonito poder formar una amistad contigo. Siempre deseé que tu trato conmigo fuera igual al que tenías con los demás del salón. Me refiero a que con ellos eras bromista y cariñosa, pero conmigo un poco más seria y reservada. Sé el porqué de eso, o creo saberlo, pero aun así me hubiera gustado haber alcanzado ese nivel de confianza contigo. No sé si realmente las cosas fueron así, pero desde mi perspectiva así es como lo sentí. Quizás, si me hubiera esforzado más en enmendar mis errores contigo, todo habría sido un poco más agradable para ambos, al tratarnos como amigos.
Ahora recuerdo que me preguntaste qué significaba, o por qué te puse “Sakura” o “árbol de sakura”. En sí, la palabra está relacionada con una flor muy especial en la cultura japonesa (de la cual soy muy fan, por cierto). Su significado se asocia a la pureza y la belleza de la naturaleza, y también a lo fugaz de la vida, ya que su periodo de florecimiento solo se da en primavera y dura muy poco, alrededor de dos semanas. Yo te asocié con este árbol porque, para mí, representas belleza y pureza. Además, cuando te veo siento esa misma calidez que llega con la primavera después de un frío invierno. Asimismo, tus lindos cachetes rosados me recuerdan un poco a la colorcita (como dirías tú, jaja) de los pétalos de este árbol, o mejor dicho, de su flor, que por cierto es mi favorita. No sé si lo recuerdas, pero el collar que te regalé en Tarapoto fue un intento de simbolizar esto. Personalmente no me convenció del todo al comprarlo, pero fue lo más parecido que encontré a este árbol.`
     },
     {
        id: crypto.randomUUID(),
        title: "Carta 4 — FUTURO",
        tags: ["amor", "despedida"],
        date: "2025-08-15",
        content: `Sabiendo que este es nuestro último año en el colegio, recuerda siempre lo que hablamos sobre no perder el tiempo y aprovechar todas las oportunidades que se te presenten en la vida. Aprovecha cada una de ellas, siempre y cuando sean de utilidad para tu futuro y realización como persona. Recuerda también elegir una profesión que te guste, no una que te impongan. Por mi parte, doy fe de que, en lo que sea que escojas, vas a brillar. Eso sí, siempre esfuérzate y aférrate a tu meta. No te lo digo solo porque sí, te lo digo porque logré ver ciertas cualidades en ti, y por ellas te admiro. Te deseo los mayores éxitos, y que Dios y tu familia siempre estén contigo.
Yo deseo que, más adelante, quizá podamos volver a vernos, ya sea por casualidad o porque nunca perdimos el contacto, aunque no hablemos mucho. Sea cual sea la situación en que coincidamos nuevamente, quiero y deseo poder verte siendo una mujer que refleje éxito y felicidad con la vida que lograste construirte. Principalmente, deseo que sigas teniendo buenos lazos con tu familia, puesto que ellos jamás te darán la espalda y siempre caminarán contigo. Personalmente, yo considero exitosa a una persona cuando, al preguntar por ella, todos solo tienen buenos comentarios, aun cuando no esté forrada en dinero. Recuerda que lo más importante en la vida es seguir siendo humilde y respetuosa.
Por mi parte, ya sabes que daré lo mejor de mí para conseguir mi meta de ser uno de los mejores médicos. También trabajaré en mi desarrollo personal, para que cuando nos volvamos a ver, veas que sí tuve un cambio para bien. Sé que decirlo es fácil, pero también sé que lo haré. Tardaré, sí, pero lo lograré.
No olvides que me dijiste que si abrías un restaurante o un menú, o lo que fuera, ibas a ponerle “QUEMADO” a uno de los platos. ¡Pobre de mí si llego y no encuentro un plato con ese nombre! 😝 (Eso es por la foto en la que sacas la lengua, jajaja).
Ya verás que algún día llegarás al hospital donde estaré trabajando, y yo mismo te sacaré muestras de sangre… ya tengo juradas tus venas, ¡no lo olvides! Jajaja, cruda.
Sé que mi humor y mis chistes son terribles, pero ríete al menos un poquito con ellos.`
    },
    {
        id: crypto.randomUUID(),
        title: "Carta 5 — ATRAPADO EN TU MAREA",
        tags: ["amor", "despedida"],
        date: "2025-08-15",
        content: `A veces tú eres como este inmenso y vasto mar: dura e implacable. Cada vez que estoy cerca de ti, con tus inmensas olas me alejas, impidiendo que este niño encuentre un puerto seguro en tu ser.
Como un bravo mar al caer la oscura noche, te vuelves más violenta y menos segura para mí. Pero eso no me importa, ni me importará nunca, porque con tal de sentirte cerca de mí elijo aventurarme en tus aguas, aun sabiendo el riesgo que corro.
Aunque me ahogue en vagas ilusiones que se desvanecen como espuma en la orilla, sé que tarde o temprano entenderé el peligro de seguir persiguiéndote.
Pero, tal como un niño pequeño e inocente, no aprenderé hasta que tus olas me arrastren, con toda su fuerza, sobre la arena.
Tal como este, escribí muchos más a lo largo de estos dos años. No obstante, por la vergüenza y el roche, nunca te los di y terminé borrándolos. De más está decir que tú, junto con mi estado de ánimo, fuiste mi inspiración para escribir.

Este texto —o poema, como suelo llamarlo yo— refleja, en cierta manera, la historia que vivía a diario tratando de acercarme a ti. Pero, por muchos factores que hoy en día, al pensarlo, veo que fueron simples e insignificantes, me terminaba acobardando. Porque, de alguna manera, me sentía un poco intimidado por ti. Confieso eso.`
    },
    {
        id: crypto.randomUUID(),
        title: "Carta 6 — HASTA QUE……",
        tags: ["amor", "despedida"],
        date: "2025-08-15",
        content: `Como dicen por ahí, todo lo bueno tiene su final. Para mí, esto de decirte adiós no es fácil, ya que, al despedirme de ti, se irán también muchos sentimientos y sensaciones que solo tú lograste despertar en mí sin proponértelo. Sé que voy a extrañarte demasiado; la sola idea de que cada vez está más cerca el último día de clases me pone muy triste. Quién sabe, quizá ese día no pueda controlar mis emociones y termine llorando. Solo quiero decirte que estas pequeñas cartas que te he escrito son lo más parecido a un resumen de todo lo que en algún momento llegué a sentir por ti. Y también quiero expresarte que te voy a recordar por varios años más, pues como ya te dije —y lo recalco nuevamente—, serás parte de los mejores momentos sentimentales que he podido experimentar en mi corta vida. Sé que puede sonar exagerado lo que escribo, pero quizás contigo sí me enamoré por primera vez en mi vida, jeje.
Creo que esto, más que un adiós, sería más bien un HASTA QUE LA VIDA NOS VUELVA A ENCONTRAR. No lo sé, todo es tan incierto… pero doy fe y esperanza de ello. Y cuando suceda, te recordaré que tú decías “NO”, Marimar.
Por último, quiero decirte que, al entregarte esto, es mi manera de darle un cierre y un poco de paz a mis sentimientos, para poder sentirme mejor conmigo mismo. Porque, al final, aunque no logré decírtelo en persona, con mi propia voz, al menos encontré en la escritura una forma de expresarte todo lo que sentía.
Así es como decidí poner fin a esta montaña rusa de sentimientos obsesivos y locos que viví por ti.
Hasta un futuro no muy lejano, mi sitio de amor. Cuídate, y recuerda que, si algún día necesitas a alguien con quien hablar o alguien que te dé una mano, puedes contar conmigo. No dudes en buscarme, porque encontrarme será fácil… y más aún si se trata de ti.
TE QUIERE POR MONTONES, JDCR`
     }     
    ];

    // Estado
    let state = {
      q: new URLSearchParams(location.search).get('q') || '',
      tag: new URLSearchParams(location.search).get('tag') || '',
      letters: [...LETTERS],
      editingId: null,
      readingId: null,
    };

    // UI refs
    const list = document.getElementById('list');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');
    const filterTag = document.getElementById('filterTag');
    const countPill = document.getElementById('countPill');
    const filterPill = document.getElementById('filterPill');

    const reader = document.getElementById('reader');
    const readerTitle = document.getElementById('readerTitle');
    const readerContent = document.getElementById('readerContent');
    const readerMeta = document.getElementById('readerMeta');
    const closeReader = document.getElementById('closeReader');
    const copyBtn = document.getElementById('copyBtn');
    const printBtn = document.getElementById('printBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    const editor = document.getElementById('editor');
    const editorTitle = document.getElementById('editorTitle');
    const saveCard = document.getElementById('saveCard');
    const cancelEdit = document.getEle
